<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Marketplace</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;text-align:center}
header{background:#1e293b;padding:15px}
button{padding:8px 12px;margin:5px;border:none;border-radius:8px;background:#f97316;color:white;cursor:pointer}
input,textarea{padding:6px;margin:4px;border-radius:6px;border:none;width:80%;max-width:300px}
.product{background:#1e293b;margin:15px auto;padding:15px;border-radius:15px;width:330px}
img{max-width:100%;border-radius:10px}
#addBtn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;font-size:26px}
.review{background:#334155;margin:5px;padding:5px;border-radius:6px;font-size:14px}
</style>
</head>
<body>

<header>
<input id="search" placeholder="Пошук..." oninput="loadProducts()">
</header>

<div id="auth"></div>
<div id="main" style="display:none;">
<h3>Товари</h3>
<div id="products"></div>
</div>

<button id="addBtn" style="display:none;" onclick="showForm()">+</button>

<div id="form" style="display:none;">
<h3>Додати товар</h3>
<input id="name" placeholder="Назва"><br>
<textarea id="desc" placeholder="Опис"></textarea><br>
<input id="price" type="number" placeholder="Ціна USD"><br>
<input id="paypal" placeholder="PayPal Email"><br>
<input type="file" id="image"><br>
<button onclick="addProduct()">Опублікувати</button>
<button onclick="hideForm()">Закрити</button>
</div>

<script>

let user=localStorage.getItem("user");
let cart=[];

function showAuth(){
if(!user){
auth.innerHTML=`
<h3>Реєстрація</h3>
<input id="u" placeholder="Ім'я"><br>
<input id="p" type="password" placeholder="Пароль"><br>
<button onclick="register()">Зареєструватись</button>
<button onclick="login()">Увійти</button>
`;
}else{
auth.innerHTML=`Вітаємо, <b>${user}</b> 
<button onclick="logout()">Вийти</button>`;
main.style.display="block";
addBtn.style.display="block";
loadProducts();
}
}

function register(){
let users=JSON.parse(localStorage.getItem("users")||"{}");
if(users[u.value]) return alert("Існує");
users[u.value]=p.value;
localStorage.setItem("users",JSON.stringify(users));
alert("Готово");
}

function login(){
let users=JSON.parse(localStorage.getItem("users")||"{}");
if(users[u.value]===p.value){
localStorage.setItem("user",u.value);
location.reload();
}else alert("Помилка");
}

function logout(){
localStorage.removeItem("user");
location.reload();
}

function showForm(){form.style.display="block";}
function hideForm(){form.style.display="none";}

function addProduct(){
let reader=new FileReader();
reader.onload=function(){
let products=JSON.parse(localStorage.getItem("products")||"[]");
products.push({
id:Date.now(),
user:user,
name:name.value,
desc:desc.value,
price:price.value,
paypal:paypal.value,
image:reader.result,
reviews:[]
});
localStorage.setItem("products",JSON.stringify(products));
hideForm();
loadProducts();
};
if(image.files[0]) reader.readAsDataURL(image.files[0]);
}

function addToCart(id){
cart.push(id);
alert("Додано в кошик");
}

function addReview(id){
let products=JSON.parse(localStorage.getItem("products")||"[]");
let text=prompt("Ваш відгук:");
let rating=prompt("Оцінка 1-5:");
products.forEach(p=>{
if(p.id==id){
p.reviews.push({user:user,text:text,rating:rating});
}
});
localStorage.setItem("products",JSON.stringify(products));
loadProducts();
}

function loadProducts(){
let products=JSON.parse(localStorage.getItem("products")||"[]");
let s=search.value.toLowerCase();
let html="";

products.filter(p=>p.name.toLowerCase().includes(s)).forEach(p=>{
html+=`
<div class="product">
<h3>${p.name}</h3>
<img src="${p.image}">
<p>${p.desc}</p>
<p><b>$${p.price}</b></p>

<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick
&business=${p.paypal}
&item_name=${encodeURIComponent(p.name)}
&amount=${p.price}
&currency_code=USD"
target="_blank">
<button>Купити через PayPal</button>
</a>

<button onclick="addToCart(${p.id})">В кошик</button>
<button onclick="addReview(${p.id})">Відгук</button>

<div>
${p.reviews.map(r=>`
<div class="review">
⭐ ${r.rating}<br>
${r.text}<br>
— ${r.user}
</div>`).join("")}
</div>

</div>
`;
});

productsDiv.innerHTML=html;
}

showAuth();

</script>

</body>
</html>
