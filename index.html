<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketplace Demo</title>
<style>
body{margin:0;font-family:Arial;background:#121826;color:white;text-align:center}
header{padding:15px;background:#1f2937}
input,textarea,button{padding:8px;margin:5px;border-radius:8px;border:none}
button{background:#f97316;color:white;cursor:pointer}
.product,.profile{
background:#1e293b;
margin:15px auto;
padding:15px;
border-radius:15px;
width:320px
}
img{max-width:100%;border-radius:10px;margin:5px 0}
#cart{background:#0f172a;padding:10px;margin:10px}
</style>
</head>
<body>

<header>
<h2>Marketplace Demo</h2>
<input id="search" placeholder="–ü–æ—à—É–∫..." oninput="loadProducts()">
</header>

<div id="auth"></div>
<div id="app" style="display:none;">

<h3>–ü—Ä–æ—Ñ—ñ–ª—å</h3>
<input type="file" id="profilePic">
<br>
<textarea id="profileDesc" placeholder="–û–ø–∏—Å –ø—Ä–æ—Ñ—ñ–ª—é"></textarea>
<br>
<button onclick="saveProfile()">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>

<div id="profile"></div>

<hr>

<h3>–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
<input id="name" placeholder="–ù–∞–∑–≤–∞">
<textarea id="desc" placeholder="–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É"></textarea>
<input id="price" type="number" placeholder="–¶—ñ–Ω–∞ USD">
<input type="file" id="images" multiple>
<br>
<button onclick="addProduct()">–î–æ–¥–∞—Ç–∏</button>

<h3>–¢–æ–≤–∞—Ä–∏</h3>
<div id="products"></div>

<hr>

<h3>üõí –ö–æ—à–∏–∫</h3>
<div id="cart"></div>
<button onclick="checkout()">–û–ø–ª–∞—Ç–∏—Ç–∏ —á–µ—Ä–µ–∑ PayPal</button>

</div>

<script>
let currentUser=localStorage.getItem("user");
let cart=[];

function showAuth(){
if(!currentUser){
auth.innerHTML=`
<input id="u" placeholder="Username">
<input id="p" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
`;
}else{
auth.innerHTML=`–õ–æ–≥—ñ–Ω: <b>${currentUser}</b>
<button onclick="logout()">–í–∏–π—Ç–∏</button>`;
app.style.display="block";
loadProfile();
loadProducts();
}
}

function register(){
let users=JSON.parse(localStorage.getItem("users")||"{}");
if(users[u.value]) return alert("–Ü—Å–Ω—É—î");
users[u.value]=p.value;
localStorage.setItem("users",JSON.stringify(users));
alert("–ì–æ—Ç–æ–≤–æ");
}

function login(){
let users=JSON.parse(localStorage.getItem("users")||"{}");
if(users[u.value]===p.value){
localStorage.setItem("user",u.value);
location.reload();
}else alert("–ü–æ–º–∏–ª–∫–∞");
}

function logout(){
localStorage.removeItem("user");
location.reload();
}

function saveProfile(){
let reader=new FileReader();
reader.onload=function(){
localStorage.setItem("profile_"+currentUser,JSON.stringify({
pic:reader.result,
desc:profileDesc.value
}));
loadProfile();
};
if(profilePic.files[0]) reader.readAsDataURL(profilePic.files[0]);
}

function loadProfile(){
let data=JSON.parse(localStorage.getItem("profile_"+currentUser)||"null");
if(!data) return;
profile.innerHTML=`
<div class="profile">
<img src="${data.pic}">
<p>${data.desc}</p>
</div>`;
}

function addProduct(){
let readers=[];
let files=images.files;
for(let i=0;i<files.length;i++){
readers.push(new Promise(resolve=>{
let r=new FileReader();
r.onload=()=>resolve(r.result);
r.readAsDataURL(files[i]);
}));
}
Promise.all(readers).then(imgs=>{
let products=JSON.parse(localStorage.getItem("products")||"[]");
products.push({
id:Date.now(),
user:currentUser,
name:name.value,
desc:desc.value,
price:price.value,
images:imgs
});
localStorage.setItem("products",JSON.stringify(products));
loadProducts();
});
}

function addToCart(id){
cart.push(id);
updateCart();
}

function updateCart(){
cartDiv="";
let products=JSON.parse(localStorage.getItem("products")||"[]");
let total=0;
cart.forEach(id=>{
let p=products.find(x=>x.id==id);
if(p){
total+=parseFloat(p.price);
cartDiv+=p.name+" - $"+p.price+"<br>";
}
});
cartDiv+="<hr>Total: $"+total;
cart.innerHTML=cartDiv;
}

function loadProducts(){
let products=JSON.parse(localStorage.getItem("products")||"[]");
let s=search.value.toLowerCase();
let html="";
products.filter(p=>p.name.toLowerCase().includes(s)).forEach(p=>{
html+=`
<div class="product">
<h4>${p.name}</h4>
<p>${p.desc}</p>
<p>$${p.price}</p>
${p.images.map(img=>`<img src="${img}">`).join("")}
<button onclick="addToCart(${p.id})">–í –∫–æ—à–∏–∫</button>
</div>
`;
});
productsDiv.innerHTML=html;
}

function checkout(){
alert("–¢—É—Ç –±—É–¥–µ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è PayPal API");
}

showAuth();
</script>

</body>
</html>
